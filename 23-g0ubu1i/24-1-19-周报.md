# 一、本周总结
学习制作BadUSB
NSSCTF
# 二、下周安排
NSSCTF
数论
N1CTF junior 报名
# 三、学到了什么
## 1.BadUSB-树莓派
### 下载固件等
1.CircuitPython UF2文件
[https://circuitpython.org/board/raspberry_pi_pico/](https://circuitpython.org/board/raspberry_pi_pico/)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39265092/1705547793064-02a1112b-08c2-4c04-9236-8676f3744e59.png#averageHue=%23c3c2c2&clientId=uc0fcd57a-d58a-4&from=paste&height=631&id=eB0mt&originHeight=1136&originWidth=2380&originalType=binary&ratio=1.8000000715255737&rotation=0&showTitle=false&size=1319889&status=done&style=none&taskId=u3338cb07-cb35-41e2-a330-b0edd9c306a&title=&width=1322.2221696818337)
2.Adafruit_CircuitPython库
[https://github.com/adafruit/Adafruit_CircuitPython_Bundle/releases/latest](https://github.com/adafruit/Adafruit_CircuitPython_Bundle/releases/latest)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39265092/1705547835231-9b11c365-7e85-48ed-b301-81be288e2096.png#averageHue=%23fefbfb&clientId=uc0fcd57a-d58a-4&from=paste&height=349&id=z0bAI&originHeight=629&originWidth=971&originalType=binary&ratio=1.8000000715255737&rotation=0&showTitle=false&size=73980&status=done&style=none&taskId=ub68592d5-4048-4806-8acc-525a5f95142&title=&width=539.444423008849)
3.pico-ducky

[https://github.com/dbisu/pico-ducky](https://github.com/dbisu/pico-ducky)[h、https://pico.org.cn/](https://pico.org.cn/)
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39265092/1705548002763-03a4af53-92ea-43f7-bb7d-fc5f15d1370a.png#averageHue=%23fefcfc&clientId=uc0fcd57a-d58a-4&from=paste&height=704&id=wrcc8&originHeight=1267&originWidth=1659&originalType=binary&ratio=1.8000000715255737&rotation=0&showTitle=false&size=209212&status=done&style=none&taskId=u83ed2410-9431-435b-8fb1-cdadf578d53&title=&width=921.6666300429252)
### 烧录固件，写代码
按住Pico的BOOTSEL按钮，将Pico插入电脑
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39265092/1705548339694-76ec6625-7309-4800-8a29-b65af1e69e1f.png#averageHue=%23c6eaa6&clientId=uc0fcd57a-d58a-4&from=paste&height=168&id=mLdKW&originHeight=303&originWidth=790&originalType=binary&ratio=1.8000000715255737&rotation=0&showTitle=false&size=26916&status=done&style=none&taskId=u34a48c3a-9b39-496f-906a-93415b6832d&title=&width=438.888871449012)
将.UF2文件放入Pico的文件夹，放入后Pico会断开连接，待固件烧录后重新恢复连接。
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39265092/1705548484689-fd00bd31-ccc6-40ed-8eb0-6ee572ed85bb.png#averageHue=%23efcd80&clientId=uc0fcd57a-d58a-4&from=paste&height=242&id=Knadz&originHeight=435&originWidth=2005&originalType=binary&ratio=1.8000000715255737&rotation=0&showTitle=false&size=47421&status=done&style=none&taskId=u69da081b-7c1c-4c80-a937-bfd17118cde&title=&width=1113.888844626923)
随后将 adafruit-circuitpython-bundle文件下的lib文件夹中的5个文件复制入Pico的lib文件中
![image.png](https://cdn.nlark.com/yuque/0/2024/png/39265092/1705548688676-fc8701fc-1153-4191-a278-baaf8d37a4c7.png#averageHue=%23fcfbfb&clientId=uc0fcd57a-d58a-4&from=paste&height=192&id=MPbY1&originHeight=345&originWidth=1268&originalType=binary&ratio=1.8000000715255737&rotation=0&showTitle=false&size=25861&status=done&style=none&taskId=u73b98456-57a6-4866-9b80-bb29b6ee300&title=&width=704.4444164523383)
新建code.py文件内容如下
```python
import time
from adafruit_hid.keyboard import Keyboard
from adafruit_hid.keyboard_layout_us import KeyboardLayoutUS
from adafruit_hid.keycode import Keycode
import usb_hid

keyboard = Keyboard(usb_hid.devices)
keyboard_layout = KeyboardLayoutUS(keyboard)
keyboard.press(Keycode.GUI, Keycode.R)
keyboard.release_all()
time.sleep(0.5)
keyboard_layout.write("cmd")
time.sleep(0.5) 
keyboard.release_all()
keyboard.press(Keycode.ENTER)
keyboard.release(Keycode.ENTER)
time.sleep(0.5)
keyboard_layout.write("start https://www.bilibili.com/video/BV1GJ411x7h7")
time.sleep(0.5)
keyboard.press(Keycode.ENTER)
keyboard.release(Keycode.ENTER)
```


## 2.CTF
#### （1）[CISCN 2022 西南]rsa
思路
gmpy2.lcm(a,b)生成a，b的最小公倍数，所以生成的结果即为phi，再根据已知信息解密即可
EXP
```python
from Crypto.Util.number import *
import gmpy2

lcm = 4292158730589770192682795435047249488185453170529228019750042608688907718268448193363838203887391025871515871000364259326343790645215256385842265899206372365402431198699714374850409466996627163968391249416054093529090485677808301343590811445080871279796162536469847469761747058736980603093722710824453312207182881241846080117790728778291633761198069016865260030288832065807438020772711645648333908622890343009942617559434851450007195025869850769670769715654662127278293639938359741401336592219730356884542179574372134014927006215640945952229142436595334916765255426954857520777553915330597952622785359222832224632624
c = 4288727484183191191687364666620023549392656794153112764357730676861570386983002380982803054964588111708662498647767438881892355599604826306427809017097724346976778230464708540600157055782723189971534549543664668430013171469625043063261219462210251726207552819381767396148632877168530609902046293626355744288863460554297860696918890189350721960355460410677203131993419723440382095665713164422367291153108363066159712951217816814873413423853338021627653555202253351957999686659021298525147460016557904084617528199284448056532965033560516083489693334373695545423561715471204868795248569806148395196572046378679014697206
N  = 17168634922359080770731181740188997952741812682116912079000170434755630873073792773455352815549564103486063484001457037305375162580861025543369063596825489461609724794798857499401637867986508655873564997664216374116361942711233205374363245780323485119184650145879389879046988234947922412374890843297813248828996855478005656041814919367820336728271583686844991928889831691815821365423570311291064846736832327637944358854661523107817781673029406341843040857813841671405147146887291204140157388049394514390098066284975682117038362207142272098796924412602725857521665773622056312191400612944442008222587867782281556388669
p3 = 29914513810588158800677413177910972738704129106546850855032986405861482276089830788972187432277517348644647399654780884571794069905291936470934226328931651386658328163535027343107140438177837479649822914209171476632450951930287641742344330471734177295804718555774395704231261550376220154493373703096062950390869299905383682611063374747752091585836452902373843865043412096365874638466683035848817858586173172058756256354758712684819253211761289032789542371351760915771791997388241121078055468403109260493642435791152671979552597191217179672328555740595434990908530985477314228867209314472001848844089467987561661918366232980944933533
q3 = 66208618374366130551979192465001581263127328176551695213970812805980115496523825511250542987452691413485117902772315362811067501379171731387904074565035353566976164797769439898266222919741874340315356585585077141595328441423323822407738375537476582506440045835592730211502035261968878999959340204806442390319739977816872969200022096331677277225467021553564212725120939434924481787524609852608476848761521446441776154400518315701988027274150425936061679275540502720782853648148897480117033152064922234451671636288396704170234613549011854618414776342798740690128675106027908639984431432591397555541420243824539205614036979987830125678
e = 65537
phi = lcm

d = inverse(e, phi)
m = int(pow(c, d, N))
print(long_to_bytes(m))
```
	总结
gmpy2.lcm()函数用来生成最小公倍数
#### （2）[NISACTF 2022]sign_crypto
思路
考察图形密码，有数学符号，可能是LATEX符号
对比后发现是符号代码的第一位
NSSCTF{EDIT_WITH_LATEX}
总结
常见LATEX符号			   [https://blog.csdn.net/LCCFlccf/article/details/89643585](https://blog.csdn.net/LCCFlccf/article/details/89643585)
在线识别网站
[https://www.latexlive.com/home](https://www.latexlive.com/home)
#### （3）[LitCTF 2023]yafu (中级)
思路
根据题目提示使用yafu分解得到phi
exp
```python
from Crypto.Util.number import *

n = 15241208217768849887180010139590210767831431018204645415681695749294131435566140166245881287131522331092026252879324931622292179726764214435307
c = 12608550100856399369399391849907846147170257754920996952259023159548789970041433744454761458030776176806265496305629236559551086998780836655717
P1 = 2201440207
P2 = 3354884521
P3 = 4171911923
P4 = 2719600579
P5 = 2151018733
P6 = 3989697563
P7 = 2315495107
P8 = 2758708999
P9 = 4044505687
P10 = 2767137487
P11 = 4021078331
P12 = 3355651511
P13 = 2906576131
P14 = 2923522073
P15 = 2585574697

phi = (P1-1)*(P2-1)*(P3-1)*(P4-1)*(P5-1)*(P6-1)*(P7-1)*(P8-1)*(P9-1)*(P10-1)*(P11-1)*(P12-1)*(P13-1)*(P14-1)*(P15-1)
d = inverse(65537,phi)
m = pow(c,d,n)
print(long_to_bytes(m))
```
总结
对n分解素数后得到多个数，phi为各数-1相乘
#### （4）[RoarCTF 2019]RSA
思路
首先遍历x，y得到符合条件的xy，然后n = x*y*z*z
在除去x*y得到n_1后开方可得到z，即可得到q，p，进而解出flag
EXP
```python
from Crypto.Util.number import *
import gmpy2
import sympy

A =  2683349182678714524247469512793476009861014781004924905484127480308161377768192868061561886577048646432382128960881487463427414176114486885830693959404989743229103516924432512724195654425703453612710310587164417035878308390676612592848750287387318129424195208623440294647817367740878211949147526287091298307480502897462279102572556822231669438279317474828479089719046386411971105448723910594710418093977044179949800373224354729179833393219827789389078869290217569511230868967647963089430594258815146362187250855166897553056073744582946148472068334167445499314471518357535261186318756327890016183228412253724
n =  117930806043507374325982291823027285148807239117987369609583515353889814856088099671454394340816761242974462268435911765045576377767711593100416932019831889059333166946263184861287975722954992219766493089630810876984781113645362450398009234556085330943125568377741065242183073882558834603430862598066786475299918395341014877416901185392905676043795425126968745185649565106322336954427505104906770493155723995382318346714944184577894150229037758434597242564815299174950147754426950251419204917376517360505024549691723683358170823416757973059354784142601436519500811159036795034676360028928301979780528294114933347127
c =  41971850275428383625653350824107291609587853887037624239544762751558838294718672159979929266922528917912189124713273673948051464226519605803745171340724343705832198554680196798623263806617998072496026019940476324971696928551159371970207365741517064295956376809297272541800647747885170905737868568000101029143923792003486793278197051326716680212726111099439262589341050943913401067673851885114314709706016622157285023272496793595281054074260451116213815934843317894898883215362289599366101018081513215120728297131352439066930452281829446586562062242527329672575620261776042653626411730955819001674118193293313612128
e = 65537
""" for x in range(2,100):
    for y in range(2,100):
        try:
            if (((y%x)**5)%(x%y))**2019+y**316+(y+1)//x == A:
                print(x,y)
                break
        except:
            pass """
x = 2
y = 83

n_1 = n // x*y
z = gmpy2.gmpy2.iroot(n_1,2)[0]
q = sympy.nextprime(z)
p = n // q
phi = (p-1)*(q-1)
d = inverse(e,phi)
m = pow(c,d,n)
print(long_to_bytes(m))
```
总结
直接分解n也可以
 
